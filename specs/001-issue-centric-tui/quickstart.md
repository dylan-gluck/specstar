# Quickstart

## Prerequisites

| Requirement                                     | Notes                                                                   |
| ----------------------------------------------- | ----------------------------------------------------------------------- |
| [Bun](https://bun.sh) >= 1.2                    | Runtime, bundler, test runner, SQLite                                   |
| [Oh-my-pi](https://github.com/can1357/oh-my-pi) | Coding agent — must be installed and configured (`omp` on PATH)         |
| Git                                             | Repository with remote configured                                       |
| Linear API key                                  | `lin_api_...` — obtain from Linear Settings > API                       |
| GitHub CLI (`gh`)                               | Authenticated — run `gh auth status` to verify                          |
| Notion API key + database ID                    | `ntn_...` — create an internal integration at notion.so/my-integrations |

## Installation

```bash
git clone <repo-url> && cd specstar
bun install
```

## Configuration

### File discovery (highest priority first)

1. `$SPECSTAR_CONFIG_FILE` — explicit path override
2. `$XDG_CONFIG_HOME/specstar/config.json` (default: `~/.config/specstar/config.json`)
3. `~/.specstar.json`
4. `.specstar.json` in cwd (project-level)

Project-level config merges onto global. Nested objects are shallow-merged; arrays are concatenated.

### Minimal config.json

```json
{
  "$schema": "./specstar.schema.json",
  "linear": {
    "apiKey": "lin_api_...",
    "teamId": "TEAM-UUID",
    "assignedToMe": true,
    "refreshInterval": 30
  },
  "github": {
    "repo": "owner/repo",
    "refreshInterval": 30
  },
  "notion": {
    "apiKey": "ntn_...",
    "databaseId": "...",
    "refreshInterval": 60
  },
  "sessions": {
    "model": "claude-sonnet",
    "thinkingLevel": "high",
    "maxConcurrent": 8,
    "worktreeBase": "../worktrees"
  }
}
```

### Environment variables

| Variable                  | Purpose                   |
| ------------------------- | ------------------------- |
| `SPECSTAR_LINEAR_API_KEY` | Linear API authentication |
| `SPECSTAR_NOTION_API_KEY` | Notion API authentication |
| `SPECSTAR_CONFIG_FILE`    | Config file path override |

### Setup wizard

```bash
specstar setup
```

Interactive wizard that:

1. Detects GitHub repo from git remote
2. Prompts for Linear API key, validates it, lists teams for selection
3. Prompts for Notion API key and database selection
4. Configures max concurrent sessions
5. Writes config to project or global location

## Development

```bash
bun run dev          # Start TUI in dev mode (bun src/index.tsx)
bun run fmt          # Format with oxfmt
bun run fmt:check    # Check formatting without writing
bun run lint         # Lint with oxlint
bun run lint:fix     # Lint and auto-fix
bun test             # Run test suite
```

## Schema Generation

Generate the JSON Schema from TypeScript config types:

```bash
bun run schema       # Generate specstar.schema.json from src/config.ts
```

The schema is generated by `ts-json-schema-generator` and provides editor autocompletion when referenced via `"$schema"` in config files.

## Build

Compile a standalone binary:

```ts
// build.ts
import solidPlugin from "@opentui/solid/bun-plugin";

await Bun.build({
  entrypoints: ["./src/index.tsx"],
  plugins: [solidPlugin],
  compile: {
    target: "bun-darwin-arm64",
    outfile: "./dist/specstar",
  },
});
```

```bash
bun run build.ts
```

Output: `./dist/specstar` binary in `dist/` directory.

Symlink for global access:

```bash
ln -sf "$(pwd)/dist/specstar" /usr/local/bin/specstar
```

## Project Structure

```
src/
  index.tsx              # Application entry point

docs/
  DESIGN.md              # Original 4-card grid design
  DESIGN-2.md            # Issue-centric master-detail design

specs/
  001-issue-centric-tui/
    spec.md              # Feature specification
    research.md          # Research findings
    quickstart.md        # This file
```

Planned `src/` layout (per DESIGN-2.md):

```
src/
  tui/                   # SolidJS/OpenTUI components (Dialog + Toast based)
    layout.tsx            # Master-detail layout
    issue-list.tsx        # Left pane: issue list with sections
    issue-detail.tsx      # Right pane: tabbed detail view
    command-palette.tsx   # Dialog-based command palette
    theme.ts              # Base16 semantic color mapping
  integrations/           # Per-integration services (Linear, GitHub, Notion)
  sessions/               # Bun Worker actors for agent sessions
  config/                 # JSON config loading + schema validation
  db/                     # SQLite schema, migrations, per-service tables
  index.tsx               # Entry point

scripts/
  generate-schema.ts     # ts-json-schema-generator -> specstar.schema.json
```

## Key Concepts

**Issue as primary entity.** Every view radiates from a Linear issue. Sessions, PRs, specs, and worktrees are linked to issues through branch name matching — not stored foreign keys. The issue list is the single navigational spine.

**Master-detail layout.** Left pane: issue list grouped into sections (Attention, Active, Backlog, Unlinked). Right pane: detail tabs (Overview, Spec, Review) for the selected issue. Section grouping and status badge priority are pure functions over enriched issue state.

**Session pool and worker isolation.** Agent sessions run in Bun Workers as actors. Each worker owns its session lifecycle. Communication with the main thread is via `postMessage` with JSON-serialized immutable events. `maxConcurrent` caps parallelism.

**JSON configuration with schema validation.** Configuration uses JSON format with a JSON Schema generated from TypeScript types via `ts-json-schema-generator`. The `$schema` field in config files enables editor autocompletion. Settings are validated at load time against the schema.

**Base16 theme integration.** The TUI uses the terminal's base16 color palette by default, mapping ANSI colors 0-15 to semantic roles (foreground, background, accent, error, warning, success). Theme overrides are configurable in settings.

**Keybind customization.** All keyboard bindings are configurable via the JSON settings file with defaults documented in the generated schema.

**Agent skills.** Coding agents activate the `opentui` skill for implementation context. Review agents use the `pilotty` skill and `pilotty` CLI for headless TUI testing.

**Enrichment and branch matching.** Cross-entity linking is computed at the application layer. A session or PR is associated with an issue when its branch name contains the issue identifier. No cross-service foreign keys exist in SQLite -- each service owns its own tables.

**Command palette as action gateway.** All actions (start session, approve tool call, open PR, refresh) are invoked through the command palette (`/`). Context-sensitive: available commands change based on the selected issue and its state.
